import{ay as U,a as S,J as i,a7 as j,a3 as H,a2 as F,S as O,O as M,L as s,n as t,R,aU as W,E as v,W as I,H as b,V as Y,U as h,aV as G,P as q,K as J,T as K,Q as P,Y as $,Z as Q,a5 as Z,F as X,aW as ee,a6 as z,_ as ae,a4 as te,aR as le,ae as T}from"./index-Db0vexY2.js";import{g as se}from"./gameService-C_phNESk.js";import{s as B}from"./Toast-CP6CXrnL.js";import{V as ne}from"./VForm-DZERiIuS.js";import{V as oe,_ as ie}from"./ConfirmDialog-GWLvpLjZ.js";import{g as A}from"./uiMeta-B6m7eSIp.js";import{V as ue}from"./VDataTableServer-BSjrfDhu.js";import"./VPagination-BNAUXgdD.js";const E={async getPageMachineInfos({page:r=0,size:c=24,keyword:m,gameId:p}={}){const{data:u}=await U.get("/api/v1/machine/info/page",{params:{page:r,size:c,keyword:m,gameId:p}});return u},async saveMachine(r){await U.post("/api/v1/machine",r)},async updateMachine(r,c){await U.put(`/api/v1/machine/${r}`,c)}},de={key:0,class:"text-red text-caption"},ce={__name:"MachineSaveDialog",props:{modelValue:Boolean,editItem:{type:Object,default:null}},emits:["update:modelValue","save"],setup(r,{emit:c}){const m=r,p=c,u=S({get:()=>m.modelValue,set:e=>p("update:modelValue",e)}),d=S(()=>!!m.editItem),f=i(null),y=i(!1),o=j({...{idxNo:null,machineId:"",gameId:null}});function k(){var e,a;o.idxNo=null,o.machineId="",o.gameId=null,(a=(e=f.value)==null?void 0:e.resetValidation)==null||a.call(e)}function g(e){var a,n;o.idxNo=(e==null?void 0:e.idxNo)??null,o.machineId=(e==null?void 0:e.machineId)??"",o.gameId=(e==null?void 0:e.gameId)??null,(n=(a=f.value)==null?void 0:a.resetValidation)==null||n.call(a)}const x=()=>{u.value=!1};H(()=>u.value,e=>{if(!e){k();return}m.editItem?g(m.editItem):k()});const V=async()=>{var n;const{valid:e}=await((n=f.value)==null?void 0:n.validate());!e||!await w()||(p("save"),x())},w=async()=>{try{return y.value=!0,d.value?await E.updateMachine(o.idxNo,o):await E.saveMachine(o),!0}catch(e){return B((e==null?void 0:e.message)||"머신 정보 변경에 실패했습니다."),!1}finally{y.value=!1}};F(()=>{N()});const C=i([]),N=async()=>{try{const e=await se.getAllGames();C.value=e}catch(e){B((e==null?void 0:e.message)||"게임 조회에 실패했습니다.")}},D=[e=>!!e||"머신 ID는 필수입니다.",e=>(e==null?void 0:e.length)<=10||"머신 ID는 최대 10자까지 입력 가능합니다."],l=e=>e!==null&&e!==""||"필수 선택 항목입니다.";return(e,a)=>(M(),O(oe,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=n=>u.value=n),persistent:"","max-width":"450"},{default:s(()=>[t(R,null,{default:s(()=>[t(W,{class:"d-flex justify-space-between align-center"},{default:s(()=>[v("span",null,I(d.value?"머신 수정":"머신 등록"),1),t(b,{icon:"",variant:"text",onClick:x},{default:s(()=>[t(Y,null,{default:s(()=>[...a[3]||(a[3]=[h("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),t(G,{class:"pt-0"},{default:s(()=>[t(ne,{ref_key:"form",ref:f},{default:s(()=>[t(q,{dense:""},{default:s(()=>[d.value?K("",!0):(M(),J("span",de,"* 머신 ID 는 등록 후 수정이 불가능 합니다.")),t(P,{cols:"12"},{default:s(()=>[t($,{modelValue:o.machineId,"onUpdate:modelValue":a[0]||(a[0]=n=>o.machineId=n),label:"머신 ID",variant:"outlined",density:"compact",rules:D,disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),t(P,{cols:"12"},{default:s(()=>[t(Q,{modelValue:o.gameId,"onUpdate:modelValue":a[1]||(a[1]=n=>o.gameId=n),items:C.value,"item-title":"gameName","item-value":"gameId",label:"게임",variant:"outlined",density:"compact",rules:[l]},{item:s(({props:n,item:L})=>[t(Z,X(n,{subtitle:L.raw.gameId}),null,16,["subtitle"])]),_:1},8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(ee,null,{default:s(()=>[t(z),t(b,{color:"error",onClick:x},{default:s(()=>[...a[4]||(a[4]=[h("취소",-1)])]),_:1}),t(b,{color:"primary",loading:y.value,onClick:V},{default:s(()=>[h(I(d.value?"수정":"등록"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},me={class:"d-flex align-center ga-3 mb-2"},re={class:"d-flex flex-column"},pe={class:"text-caption"},ve={class:"d-flex justify-end ga-1"},fe={__name:"index",setup(r){const c=i(!1),m=i([]),p=i(0),u=i(1),d=i(15),f=i([]),y=[{title:"10",value:10},{title:"15",value:15},{title:"30",value:30},{title:"50",value:50}],_=i(""),o=i(""),k=[{title:"No",key:"no",sortable:!1,width:100},{title:"머신 ID",key:"machineId",sortable:!1,width:300},{title:"게임",key:"game",sortable:!1},{title:"사용여부",key:"useYn",sortable:!1},{title:"관리",key:"actions",sortable:!1,width:110,align:"center"}];async function g(){c.value=!0;try{const l=await E.getPageMachineInfos({page:u.value-1,size:d.value,keyword:_.value||"",gameId:o.value||""});m.value=(l==null?void 0:l.content)??(l==null?void 0:l.items)??(l==null?void 0:l.list)??[],p.value=(l==null?void 0:l.totalElements)??(l==null?void 0:l.total)??0}finally{c.value=!1}}function x(l){u.value=l.page,d.value=l.itemsPerPage,f.value=l.sortBy??[],g()}F(()=>{g()}),te(_,()=>{u.value=1,g()},{debounce:350,maxWait:1200});const V=i(!1),w=i(null);function C(l){w.value={...l},V.value=!0}function N(){w.value=null,V.value=!0}const D=i(!1);return(l,e)=>(M(),O(R,{variant:"outlined",height:"680",class:"pa-2",style:{"border-color":"rgba(180, 180, 181, 0.6)"}},{default:s(()=>[t(ce,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=a=>V.value=a),"edit-item":w.value,onSave:g},null,8,["modelValue","edit-item"]),t(ie,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=a=>D.value=a),message:"선택한 머신을 삭제하시겠습니까?"},null,8,["modelValue"]),v("div",me,[t($,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),density:"compact",variant:"outlined","hide-details":"",placeholder:"머신 검색 (ID)",style:{"max-width":"260px"},clearable:""},null,8,["modelValue"]),t(z),t(b,{variant:"outlined",onClick:N,class:"bg-gold"},{default:s(()=>[...e[3]||(e[3]=[h(" 머신 등록 ",-1)])]),_:1})]),t(ue,{headers:k,items:m.value,"items-length":p.value,loading:c.value,"item-value":"alarmId",density:"compact","fixed-header":"",height:"560","items-per-page":d.value,page:u.value,"onUpdate:options":x,"items-per-page-options":y,class:"alarm-table"},{"item.no":s(({index:a})=>[h(I((u.value-1)*d.value+a+1),1)]),"item.game":s(({item:a})=>{var n;return[v("div",re,[v("div",null,I((n=a.game)==null?void 0:n.gameName),1),v("div",pe,"ID: "+I(a.gameId),1)])]}),"item.useYn":s(({item:a})=>[t(le,{size:"small",variant:"flat",color:T(A)(a.useYn).color,class:"font-weight-medium"},{default:s(()=>[h(I(T(A)(a.useYn).text),1)]),_:2},1032,["color"])]),"item.actions":s(({item:a})=>[v("div",ve,[t(b,{icon:"",variant:"text",size:"x-small",onClick:n=>C(a)},{default:s(()=>[t(Y,{icon:"mdi-pencil"})]),_:1},8,["onClick"])])]),"no-data":s(()=>[...e[4]||(e[4]=[v("div",{class:"py-10 text-medium-emphasis"},"데이터가 없습니다.",-1)])]),_:1},8,["items","items-length","loading","items-per-page","page"])]),_:1}))}},be=ae(fe,[["__scopeId","data-v-c815e27f"]]);export{be as default};
