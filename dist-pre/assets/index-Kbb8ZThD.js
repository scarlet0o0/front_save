import{ay as A,a as Y,J as i,a7 as Q,a3 as Z,a2 as W,S as G,O as F,L as l,n as a,R as q,aU as X,E as g,W as b,H as D,V as H,U as V,aV as ee,P as ae,K as le,T as te,Q as N,Y as L,Z as O,a5 as se,F as oe,aW as ne,a6 as J,a4 as ue,aR as $,ae as E}from"./index-BEfUtk8q.js";import{g as ie}from"./gameService-Dnkgde7b.js";import{s as de}from"./screenClientService-CXPzpPLw.js";import{s as R}from"./Toast-Bj6FhXbI.js";import{V as re}from"./VForm-3zuL6ByH.js";import{V as me,_ as ce}from"./ConfirmDialog-RxUvG1uJ.js";import{g as j,c as M}from"./uiMeta-B6m7eSIp.js";import{V as ve}from"./VDataTableServer-Dekjmu6M.js";import"./VPagination-D01cRuXz.js";const z={async getPageTableInfos({page:p=0,size:c=24,keyword:v,gameId:f}={}){const{data:d}=await A.get("/api/v1/table/info/page",{params:{page:p,size:c,keyword:v,gameId:f}});return d},async saveTable(p){await A.post("/api/v1/table",p)},async updateTable(p,c){await A.put(`/api/v1/table/${p}`,c)}},pe={key:0,class:"text-red text-caption"},fe={__name:"TableSaveDialog",props:{modelValue:Boolean,editItem:{type:Object,default:null}},emits:["update:modelValue","save"],setup(p,{emit:c}){const v=p,f=c,d=Y({get:()=>v.modelValue,set:e=>f("update:modelValue",e)}),m=Y(()=>!!v.editItem),I=i(null),S=i(!1),t=Q({...{idxNo:null,tableId:"",tableName:"",clientId:null,tableStatus:null,gameId:null}});function C(){var e,o;t.idxNo=null,t.tableId="",t.tableName="",t.clientId=null,t.tableStatus=null,t.gameId=null,(o=(e=I.value)==null?void 0:e.resetValidation)==null||o.call(e)}function y(e){var o,u;t.idxNo=(e==null?void 0:e.idxNo)??null,t.tableId=(e==null?void 0:e.tableId)??"",t.tableName=(e==null?void 0:e.tableName)??"",t.clientId=(e==null?void 0:e.clientId)??null,t.tableStatus=(e==null?void 0:e.tableStatus)??null,t.gameId=(e==null?void 0:e.gameId)??null,(u=(o=I.value)==null?void 0:o.resetValidation)==null||u.call(o)}const w=()=>{d.value=!1};Z(()=>d.value,e=>{if(!e){C();return}v.editItem?y(v.editItem):C()});const x=async()=>{var u;const{valid:e}=await((u=I.value)==null?void 0:u.validate());!e||!await k()||(f("save"),w())},k=async()=>{try{return S.value=!0,m.value?await z.updateTable(t.idxNo,t):await z.saveTable(t),!0}catch(e){return R((e==null?void 0:e.message)||"테이블 정보 변경에 실패했습니다."),!1}finally{S.value=!1}};W(()=>{B(),r()});const U=i([]),B=async()=>{try{const e=await de.getAllScreenClients();U.value=e}catch(e){R((e==null?void 0:e.message)||"클라이언트 조회에 실패했습니다.")}},h=i([{title:"RUN",value:"1"},{title:"STOP",value:"2"}]),s=i([]),r=async()=>{try{const e=await ie.getAllGames();s.value=e}catch(e){R((e==null?void 0:e.message)||"게임 조회에 실패했습니다.")}},n=[e=>!!e||"테이블 ID는 필수입니다.",e=>(e==null?void 0:e.length)<=10||"테이블 ID는 최대 10자까지 입력 가능합니다."],T=[e=>!!e||"테이블 이름은 필수입니다.",e=>(e==null?void 0:e.length)<=30||"테이블 이름은 최대 30자까지 입력 가능합니다."],P=e=>e!==null&&e!==""||"필수 선택 항목입니다.";return(e,o)=>(F(),G(me,{modelValue:d.value,"onUpdate:modelValue":o[5]||(o[5]=u=>d.value=u),persistent:"","max-width":"450"},{default:l(()=>[a(q,null,{default:l(()=>[a(X,{class:"d-flex justify-space-between align-center"},{default:l(()=>[g("span",null,b(m.value?"테이블 수정":"테이블 등록"),1),a(D,{icon:"",variant:"text",onClick:w},{default:l(()=>[a(H,null,{default:l(()=>[...o[6]||(o[6]=[V("mdi-close",-1)])]),_:1})]),_:1})]),_:1}),a(ee,{class:"pt-0"},{default:l(()=>[a(re,{ref_key:"form",ref:I},{default:l(()=>[a(ae,{dense:""},{default:l(()=>[m.value?te("",!0):(F(),le("span",pe,"* 테이블 ID 는 등록 후 수정이 불가능 합니다.")),a(N,{cols:"12"},{default:l(()=>[a(L,{modelValue:t.tableId,"onUpdate:modelValue":o[0]||(o[0]=u=>t.tableId=u),label:"테이블 ID",variant:"outlined",density:"compact",rules:n,disabled:m.value},null,8,["modelValue","disabled"])]),_:1}),a(N,{cols:"12"},{default:l(()=>[a(L,{modelValue:t.tableName,"onUpdate:modelValue":o[1]||(o[1]=u=>t.tableName=u),label:"테이블 이름",variant:"outlined",density:"compact",rules:T},null,8,["modelValue"])]),_:1}),a(N,{cols:"12"},{default:l(()=>[a(O,{modelValue:t.clientId,"onUpdate:modelValue":o[2]||(o[2]=u=>t.clientId=u),items:U.value,"item-title":"clientId","item-value":"clientId",label:"스크린 클라이언트 프로그램 ID",variant:"outlined",density:"compact",rules:[P]},null,8,["modelValue","items","rules"])]),_:1}),a(N,{cols:"12"},{default:l(()=>[a(O,{modelValue:t.tableStatus,"onUpdate:modelValue":o[3]||(o[3]=u=>t.tableStatus=u),items:h.value,"item-title":"title","item-value":"value",label:"테이블 상태",variant:"outlined",density:"compact",rules:[P]},null,8,["modelValue","items","rules"])]),_:1}),a(N,{cols:"12"},{default:l(()=>[a(O,{modelValue:t.gameId,"onUpdate:modelValue":o[4]||(o[4]=u=>t.gameId=u),items:s.value,"item-title":"gameName","item-value":"gameId",label:"게임",variant:"outlined",density:"compact",rules:[P]},{item:l(({props:u,item:K})=>[a(se,oe(u,{subtitle:K.raw.gameId}),null,16,["subtitle"])]),_:1},8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(ne,null,{default:l(()=>[a(J),a(D,{color:"error",onClick:w},{default:l(()=>[...o[7]||(o[7]=[V("취소",-1)])]),_:1}),a(D,{color:"primary",loading:S.value,onClick:x},{default:l(()=>[V(b(m.value?"수정":"등록"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ge={class:"d-flex align-center ga-3 mb-2"},be={class:"d-flex flex-column"},Ve={class:"text-caption"},Ie={class:"d-flex justify-end ga-1"},Ce={__name:"index",setup(p){const c=i(!1),v=i([]),f=i(0),d=i(1),m=i(15),I=i([]),S=[{title:"10",value:10},{title:"15",value:15},{title:"30",value:30},{title:"50",value:50}],_=i(""),t=i(""),C=[{title:"No",key:"no",sortable:!1,width:100},{title:"테이블 ID",key:"tableId",sortable:!1,width:300},{title:"테이블 이름",key:"tableName",sortable:!1},{title:"상태",key:"tableStatus",sortable:!1},{title:"게임",key:"game",sortable:!1},{title:"Screen 클라이언트 ID",key:"clientId",sortable:!1},{title:"사용여부",key:"useYn",sortable:!1},{title:"관리",key:"actions",sortable:!1,width:110,align:"center"}];async function y(){c.value=!0;try{const s=await z.getPageTableInfos({page:d.value-1,size:m.value,keyword:_.value||"",gameId:t.value||""});v.value=(s==null?void 0:s.content)??(s==null?void 0:s.items)??(s==null?void 0:s.list)??[],f.value=(s==null?void 0:s.totalElements)??(s==null?void 0:s.total)??0}finally{c.value=!1}}function w(s){d.value=s.page,m.value=s.itemsPerPage,I.value=s.sortBy??[],y()}W(()=>{y()}),ue(_,()=>{d.value=1,y()},{debounce:350,maxWait:1200});const x=i(!1),k=i(null);function U(s){k.value={...s},x.value=!0}function B(){k.value=null,x.value=!0}const h=i(!1);return(s,r)=>(F(),G(q,{variant:"outlined",height:"680",class:"pa-2",style:{"border-color":"rgba(180, 180, 181, 0.6)"}},{default:l(()=>[a(fe,{modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=n=>x.value=n),"edit-item":k.value,onSave:y},null,8,["modelValue","edit-item"]),a(ce,{modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=n=>h.value=n),message:"선택한 테이블을 삭제하시겠습니까?"},null,8,["modelValue"]),g("div",ge,[a(L,{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=n=>_.value=n),density:"compact",variant:"outlined","hide-details":"",placeholder:"테이블 검색 (ID, 이름)",style:{"max-width":"260px"},clearable:""},null,8,["modelValue"]),a(J),a(D,{variant:"outlined",onClick:B,class:"bg-gold"},{default:l(()=>[...r[3]||(r[3]=[V(" 테이블 등록 ",-1)])]),_:1})]),a(ve,{headers:C,items:v.value,"items-length":f.value,loading:c.value,"item-value":"alarmId",density:"compact","fixed-header":"",height:"560","items-per-page":m.value,page:d.value,"onUpdate:options":w,"items-per-page-options":S,class:"alarm-table"},{"item.no":l(({index:n})=>[V(b((d.value-1)*m.value+n+1),1)]),"item.tableStatus":l(({item:n})=>[a($,{size:"small",variant:"flat",color:E(M)(n.tableStatus).color,class:"font-weight-medium"},{default:l(()=>[V(b(E(M)(n.tableStatus).text),1)]),_:2},1032,["color"])]),"item.game":l(({item:n})=>{var T;return[g("div",be,[g("div",null,b((T=n.game)==null?void 0:T.gameName),1),g("div",Ve,"ID: "+b(n.gameId),1)])]}),"item.useYn":l(({item:n})=>[a($,{size:"small",variant:"flat",color:E(j)(n.useYn).color,class:"font-weight-medium"},{default:l(()=>[V(b(E(j)(n.useYn).text),1)]),_:2},1032,["color"])]),"item.actions":l(({item:n})=>[g("div",Ie,[a(D,{icon:"",variant:"text",size:"x-small",onClick:T=>U(n)},{default:l(()=>[a(H,{icon:"mdi-pencil"})]),_:1},8,["onClick"])])]),"no-data":l(()=>[...r[4]||(r[4]=[g("div",{class:"py-10 text-medium-emphasis"},"데이터가 없습니다.",-1)])]),_:1},8,["items","items-length","loading","items-per-page","page"])]),_:1}))}};export{Ce as default};
